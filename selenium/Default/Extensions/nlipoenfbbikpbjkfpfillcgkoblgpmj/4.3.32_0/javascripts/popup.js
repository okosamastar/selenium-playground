var Bg=chrome.extension.getBackgroundPage(),camDevices=[],baseURL="https://www.awesomescreenshot.com",isSignIn=!1,meter=null,rafID=null,volumeStream=null,premiumLevel=0,totalVideoCount=20,newPremium=!1,isAllowVa=null,prepareInterval=null,isFileUrl=!1,isAllowContentJs=!0,fileAllowedAccess=!1,mediaDevices=null,haveAudioDevices=!1,haveVideoDevices=!1,isAllowedMic=!1,isAllowedCam=!1,availableAudioDevices=[],availableVideoDevices=[],init=!1,isGetUserInfo=!1;function sendMessageToTab(e,o,t){chrome.tabs.sendMessage(e,o,t)}function getCurrentTab(e,o){chrome.tabs.query(Object.assign({active:!0},e),(function(e){o(e[0])}))}function createAudioMeter(e,o,t,i){var a=e.createScriptProcessor(512);return a.onaudioprocess=volumeAudioProcess,a.clipping=!1,a.lastClip=0,a.volume=0,a.clipLevel=o||.98,a.averaging=t||.95,a.clipLag=i||750,a.connect(e.destination),a.checkClipping=function(){return!!this.clipping&&(this.lastClip+this.clipLag<window.performance.now()&&(this.clipping=!1),this.clipping)},a.shutdown=function(){this.disconnect(),this.onaudioprocess=null},a}function volumeAudioProcess(e){for(var o,t=e.inputBuffer.getChannelData(0),i=t.length,a=0,n=0;n<i;n++)o=t[n],Math.abs(o)>=this.clipLevel&&(this.clipping=!0,this.lastClip=window.performance.now()),a+=o*o;var r=Math.sqrt(a/i);this.volume=Math.max(r,this.volume*this.averaging)}function closeVolume(){$("#volume-canvas").hide(),rafID&&window.cancelAnimationFrame(rafID),meter=null,volumeStream&&(volumeStream.getTracks().forEach((function(e){e.stop()})),volumeStream=null)}function getVolume(){if("true"===localStorage.record_mic&&isAllowedMic&&!1!==$("#main-menu").is(":visible")){closeVolume(),$("#volume-canvas").show();var e=new AudioContext,o={googEchoCancellation:"false",googAutoGainControl:"false",googNoiseSuppression:"false",googHighpassFilter:"false"};localStorage["mic-deviceId"]&&(o.diviceId=localStorage["mic-deviceId"]);try{navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,navigator.getUserMedia({audio:o},(function(o){volumeStream=o,mediaStreamSource=e.createMediaStreamSource(o),meter=createAudioMeter(e),mediaStreamSource.connect(meter),drawLoop()}),(function(e){}))}catch(e){}}}function drawLoop(e){var o=document.getElementById("volume-canvas").getContext("2d");o.clearRect(0,0,5,18),meter.checkClipping()?o.fillStyle="red":o.fillStyle="#47d892",o.fillRect(0,0,5,18*meter.volume*5),rafID=window.requestAnimationFrame(drawLoop)}i18n(),"true"===localStorage["dark-mode"]&&$("body").addClass("dark-mode"),Bg.isScrollCapturing&&switchView("capturing-view");var recordingTimer=null;function updateTime(){$("#recording-view").find(".time").text(Bg.recordingTime)}function restoreSettings(){var e=localStorage.max_resolution,o="true"===localStorage.record_toolbar;"local"===localStorage["save-location"]?isSignIn&&premiumLevel>1||(e=720,o=!1):isSignIn?premiumLevel<=1&&totalVideoCount>=20&&(e=720,o=!1):(e=720,o=!1),$(".custom-select[data-option=max_resolution]").find(".select-option-item[data-value="+e+"]").trigger("mousedown"),$("#record-toolbar").prop("checked",o)}"recording"!==Bg.recordingStatus&&"preparing"!==Bg.recordingStatus&&chrome.cookies.getAll({url:baseURL},(function(e){if(chrome.runtime.lastError,e){for(var o=0,t=e.length;o<t;o++)if("screenshot_personal_fullname"===e[o].name)var i=decodeURI(e[o].value);else if("screenshot_personal_type"===e[o].name)var a=e[o].value;else if("screenshot_personal_premium_level"===e[o].name)var n=e[o].value;else if("screenshot_personal_permission"===e[o].name)e[o].value.split(",");else if("screenshot_personal_uid"===e[o].name)var r=e[o].value;i?(isSignIn=!0,$(".aws-info").find(".user-name").text(i).attr("title",i),$("#no-signin").hide(),$("#aws-account").show(),chrome.storage.local.get("userinfo",(function(e){e.userinfo&&e.userinfo.uid===r?(premiumLevel=parseInt(n),totalVideoCount=e.userinfo.totalVideoCount,newPremium=e.userinfo.newPremium,isGetUserInfo=!0,chrome.storage.local.set({userinfo:{newPremium:e.userinfo.newPremium,uid:e.userinfo.uid,premiumLevel:parseInt(n),totalVideoCount:e.userinfo.totalVideoCount}}),$(".custom-select[data-option=save-location]").find(".select-option-item[data-value="+localStorage["save-location"]+"]").trigger("mousedown",["autofill"]),setTimeout((function(){$(document.body).removeClass("no-transition")}),500)):($("#loading").addClass("active"),$.ajax({method:"GET",url:baseURL+"/api/v1/user/einfo"}).done((function(e){premiumLevel=parseInt(e.data.premiumLevel),totalVideoCount=e.data.videoTotalAllCreated,newPremium=e.data.newPremium,isGetUserInfo=!0,chrome.storage.local.set({userinfo:{newPremium,uid:r,premiumLevel,totalVideoCount}}),$("#loading").removeClass("active"),$(".custom-select[data-option=save-location]").find(".select-option-item[data-value="+localStorage["save-location"]+"]").trigger("mousedown",["autofill"]),setTimeout((function(){$(document.body).removeClass("no-transition")}),500)})).catch((function(e){$("#loading").addClass("hide"),setTimeout((function(){$(document.body).removeClass("no-transition")}),500)})))}))):(isGetUserInfo=!0,chrome.storage.local.remove("userinfo"),"local"===localStorage["save-location"]&&$(".record-tip.limit").css("display","flex"),$("#loading").addClass("hide"),$("#no-signin").show(),$("#aws-account").hide(),$(".custom-select[data-option=save-location]").find(".select-option-item[data-value="+localStorage["save-location"]+"]").trigger("mousedown",["autofill"])),"0"==a?$(".aws-user").removeClass("premium"):void 0===a?($(".aws-premium-icon").hide(),$(".aws-upgrade").hide()):$(".aws-user").addClass("premium")}})),"record"===localStorage.popupTab&&$(".tab-header").addClass("default-record"),chrome.windows.getCurrent((function(e){getCurrentTab({windowId:e.id},(function(o){chrome.browserAction.getBadgeText({tabId:o.id},(function(o){"New"==o&&(chrome.browserAction.setBadgeText({text:""}),chrome.tabs.create({url:"https://blog.awesomescreenshot.com/2021/07/08/whats-new/"}),localStorage.newClickVersion=Bg.newClickVersion,e.close())}))}))})),$("#stop-entire-capture").on("click",(function(){sendMessage({action:"stop-entire-capture"})})),$(".tab-header-item").on("click",(function(){var e=$(this).attr("data-tab");$(".tab-header").removeClass("screenshot record").addClass(e),$(".tab-header-item").removeClass("active"),$(this).addClass("active"),$(".tab-item").removeClass("active"),$(".tab-item.tab-"+e).addClass("active"),"record"===e?getVolume():"screenshot"===e&&closeVolume()})),"record"===localStorage.popupTab&&$(".tab-header-item[data-tab='record']").trigger("click"),$(".action-btn").on("click",(function(){var e=$(this);e.hasClass("option")?Bg.openNewTab("/option-react.html"):e.hasClass("feedback")?Bg.openNewTab("/feedback.html"):e.hasClass("more")?(e.toggleClass("expand"),$(".more-links").toggle()):e.hasClass("recording")?Bg.openNewTab("/video-list.html"):e.hasClass("sign-out")&&Bg.openNewTab("https://www.awesomescreenshot.com/web/user/logout")})),$(".more-links-item").on("click",(function(){var e=$(this);if(e.hasClass("mp"))var o=baseURL+"/all_images";else if(e.hasClass("mv"))o=baseURL+"/all_videos";else if(e.hasClass("logout"))o=baseURL+"/web/user/logout";Bg.openNewTab(o)}));var url,enableSelected=!0;function addShortcut(){if(localStorage.msObj){var e=JSON.parse(localStorage.msObj),o=1==e.visible.enable?"Ctrl+Shift+"+e.visible.key:"",t=1==e.selected.enable?"Ctrl+Shift+"+e.selected.key:"",i=1==e.entire.enable?"Ctrl+Shift+"+e.entire.key:"";o&&$("#visible").addClass("tooltip delay").attr("aria-label",o),o&&$("#selected").addClass("tooltip delay").attr("aria-label",t),i&&$("#entire").addClass("tooltip delay").attr("aria-label",i)}}function openPopup(e,o){var t=$(".popup[data-name="+e+"]");t.show(),o&&t.find(".popup-btn").attr("data-reason",o),"sign-in"===e&&($(".tab-header").hasClass("record")?$("#sign-in-reason").text("videos"):$("#sign-in-reason").text("screenshots"))}function closePopup(e){$(".popup[data-name="+e+"]").hide()}function i18n(){$("[data-i18n-id]").each((function(){var e=$(this).attr("data-i18n-id");$(this).html(chrome.i18n.getMessage(e))})),$("[data-i18n-text-id]").each((function(){var e=$(this).attr("data-i18n-text-id");$(this).attr("data-text",chrome.i18n.getMessage(e))})),$("[data-i18n-aria-label]").each((function(){var e=$(this).attr("data-i18n-aria-label");$(this).attr("aria-label",chrome.i18n.getMessage(e))}))}function switchView(e){"main-menu"!==e&&closeVolume(),$(".layout-view").hide(),$("#"+e).show()}function capturing(){$("ul").remove(),$(".aws-account, .sep").hide(),$("#capturing").fadeIn("slow")}function sendMessage(e){chrome.runtime.sendMessage(e)}function getAllDevices(){return new Promise((function(e,o){getAllAudioVideoDevices((function(o){haveAudioDevices=(mediaDevices=o).audioInputDevices.length>0,haveVideoDevices=mediaDevices.videoInputDevices.length>0,availableAudioDevices=getDevices(mediaDevices.audioInputDevices),availableVideoDevices=getDevices(mediaDevices.videoInputDevices),e()}))}))}function getMicPermisstion(){return navigator.permissions.query({name:"microphone"}).then((function(e){return"granted"===e.state&&(isAllowedMic=!0),e.state}))}function getCamPermisstion(){return navigator.permissions.query({name:"camera"}).then((function(e){return"granted"===e.state&&(isAllowedCam=!0),e.state}))}function getDevices(e){return e.filter((function(e,o,t){return""!==e.label&&t.findIndex((function(o){return o.deviceId===e.deviceId}))===o}))}function showTry(){$(".record-tip.limit").hide(),$(".record-tip.try").css("display","flex"),$(".record-tip").find(".count").text(totalVideoCount+"/20")}function showLimit(){$(".record-tip.try").hide(),$(".record-tip.limit").css("display","flex")}function hideTip(){$(".record-tip.try").hide(),$(".record-tip.limit").hide()}function initRecordMenu(){function e(e,o){if(o.length){var t=$("#"+e+"-source");o.forEach((function(e){$("<option value='"+e.deviceId+"'>"+e.label+"</option>").appendTo(t)})),localStorage[e+"-deviceId"]&&function(e,o){for(var t=0;t<o.length;t++)if(e===o[t].deviceId)return!0;return!1}(localStorage[e+"-deviceId"],o)&&t.val(localStorage[e+"-deviceId"]),t.trigger("change")}}function o(e){var o=$("#record-mic").prop("checked"),t=$("#record-toolbar").prop("checked"),i=$("input[name=record-type]:checked").val(),a=localStorage.record_countdown,n=$(".custom-select[data-option=max_resolution]").attr("data-value")||720,r=$(".custom-select[data-option=save-location").attr("data-value"),c=$("#record-cam").prop("checked"),s="camera"!==i?$("#cam-source").val():$("#cam-only-source").val(),l=$("#mic-source").val(),d=$("#record-tabsound").prop("checked");if(!o&&availableAudioDevices.length>0&&!e&&"true"===localStorage["allow-remind-mic"])openPopup("open-mic");else{var u={isRecordMic:o,recordType:i,countdown:a,saveLocation:r,resolution:n,isRecordCam:c,isShowToolbar:t,camDeviceId:s,micDeviceId:l,isRecordTabSound:d},p=window.screen.width,m=window.screen.height,g={"4k":{width:3084,height:2160},1080:{width:1920,height:1080},720:{width:1280,height:720}};if("desktop"===i&&(p<g[n].width?(u.width=p,u.height=m):(u.width=g[n].width,u.height=g[n].height)),"cloud"===localStorage["save-location"]){if(isSignIn){if(haveAudioDevices&&0===availableAudioDevices.length)h="/setup-react.html?from=record&isSignIn=true"}else if(haveAudioDevices){if(0!==availableAudioDevices.length)return void openPopup("sign-in","record");var h="/setup-react.html?from=record"}else var h="/setup-react.html?from=record&isGranted=true";if(h&&("true"!==localStorage.has_setup||!isSignIn))return chrome.tabs.create({url:h}),void(localStorage.has_setup=!0)}sendMessage({action:"record",options:u}),window.close()}}Promise.all([getAllDevices(),getMicPermisstion(),getCamPermisstion()]).then((function(){isAllowedMic&&"true"==localStorage.record_mic&&availableAudioDevices.length>0&&($("#record-mic").prop("checked",!0),$("#record-mic").parents(".record-option-item").find(".source-part").show(),$("volume-canvas").show()),isAllowedCam&&"true"==localStorage.record_cam&&availableVideoDevices.length>0&&($("#record-cam").prop("checked",!0),$("#record-cam").parents(".record-option-item").find(".source-part").show()),$(".device-select").find("select").on("change",(function(){var e=$(this).attr("data-source"),o=$(this).val();localStorage[e+"-deviceId"]=o,"true"==localStorage.record_mic&&$(".tab-record").hasClass("active")&&"mic"===e&&getVolume()})),$("input[name=record-type]").on("change",(function(){localStorage.record_type=this.value,$(".record-type-item").removeClass("selected"),$("#record-type-"+this.value).parents(".record-type-item").addClass("selected"),"tab"!==this.value?$(".record-option-tabsound").hide():$(".record-option-tabsound").show(),"camera"===this.value?($(".record-option-camera").hide(),$(".record-option-camera-only").show(),$(".record-option-toolbar").hide()):($(".record-option-camera").show(),$(".record-option-camera-only").hide(),$(".record-option-toolbar").show()),availableVideoDevices.length||("camera"===this.value?$("#record-start").addClass("disabled"):$("#record-start").removeClass("disabled"))})),$(".setup-btn").on("click",(function(){Bg.openNewTab("/getAccess.html")})),$("#record-type-"+localStorage.record_type).trigger("click").trigger("change"),availableVideoDevices.length&&!Bg.cameraStream||$("#toggle-camera").hide(),haveAudioDevices?availableAudioDevices.length?e("mic",availableAudioDevices):($(".setup-mic-btn").show(),$(".record-option-microphone").find(".action").hide()):$(".record-option-microphone").find(".record-option-title").text("No Microphone detected").addClass("no").end().find(".action").hide(),haveVideoDevices?availableVideoDevices.length?(e("cam",availableVideoDevices),e("cam-only",availableVideoDevices),$("#cam-only-source-part").show()):($(".setup-cam-btn").show(),$(".record-option-camera").find(".action").hide()):($(".record-option-camera").find(".record-option-title").addClass("no").text("No Camera detected").end().find(".action").hide(),$(".record-option-camera-only").find(".record-option-title").addClass("no").text("No Camera detected"))})).catch((function(e){})),$(".custom-select[data-option=save-location]").find(".select-option-item[data-value="+localStorage["save-location"]+"]").trigger("mousedown",["autofill"]),$(".custom-select[data-option=save-capture-location]").find(".select-option-item[data-value="+localStorage["save-capture-location"]+"]").trigger("mousedown",["autofill"]),$("#countdown-input").on("change",(function(){localStorage.record_countdown=$(this).val()})),$("#record-tabsound").prop("checked","true"===localStorage.record_tabsound),$("#record-tabsound").on("change",(function(){localStorage.record_tabsound=$(this).prop("checked")})),$("#record-toolbar").on("change",(function(){$(this).prop("checked")?isSignIn?"local"===localStorage["save-location"]?premiumLevel<=1?(openPopup("signin-local-upgrade","Reocord_toolbar"),$(this).prop("checked",!1)):localStorage.record_toolbar=!0:premiumLevel<=1&&totalVideoCount>=20?(openPopup("signin-limit-upgrade","Reocord_toolbar"),$(this).prop("checked",!1)):localStorage.record_toolbar=!0:(openPopup("no-signin-local-upgrade","Reocord_toolbar"),$(this).prop("checked",!1)):localStorage.record_toolbar=!1})),$("#local-recording").on("click",(function(){Bg.openNewTab("/video-list.html")})),$(".record-option-checkbox").on("change",(function(){var e=$(this).attr("data-type");if($(this).prop("checked")){if("mic"===e)var o=isAllowedMic;else if("cam"===e)o=isAllowedCam;localStorage["record_"+e]="true",!0===o?($("#"+e+"-source-part").show(),"cam"===e&&"true"!==localStorage.record_mic&&isAllowedMic&&availableAudioDevices&&(localStorage.record_mic="true",$("#record-mic").prop("checked",!0),$("#mic-source-part").show()),"mic"===e&&getVolume()):Bg.openNewTab("/getAccess.html")}else localStorage["record_"+e]="false",$("#"+e+"-source-part").hide(),"mic"===e&&closeVolume()})),$(".popup").find(".close").on("click",(function(){$(this).parents(".popup").hide()})),$("#request-notification").on("click",(function(){chrome.permissions.request({permissions:["notifications"]},(function(e){$("#grant-notification").hide(),o()}))})),$("#back-to-main").on("click",(function(){switchView("main-menu")})),$("#record-stop").on("click",(function(){Bg.stopStream(),window.close()})),$("#record-pause").on("click",(function(){$(this).parent().addClass("paused"),Bg.pauseScreenRecording()})),$("#record-resume").on("click",(function(){$(this).parent().removeClass("paused"),Bg.resumeScreenRecording()})),$("#record-discard").on("click",(function(){$("#discard-popup").show()})),$("#discard-cancel").on("click",(function(){$("#discard-popup").hide()})),$("#discard-confirm").on("click",(function(){Bg.stopStream(!0),window.close()})),$("#open-mic-cancel").on("click",(function(){o(!0)})),$("#open-mic-confirm").on("click",(function(){$("#record-mic").prop("checked",!0).trigger("change"),o()})),$("#record-start").on("click",(function(){if("cloud"!==localStorage["save-location"]||isSignIn)o();else{if(!haveAudioDevices)return void openPopup("sign-in","record");if(0!==availableAudioDevices.length)return void openPopup("sign-in","record");var e="/setup-react.html?from=record";chrome.tabs.create({url:e})}})),$("#popup-sign-in-btn").on("click",(function(){var e=$(this).attr("data-reason"),o="";o="capture"===e?"ext_pop_capture":"record"===e?"ext_pop_record":"ext_pop_bottom",Bg.openNewTab("https://www.awesomescreenshot.com/signin?from="+o)})),$("#capture-guide").on("click",(function(){Bg.openNewTab("https://support.awesomescreenshot.com/hc/en-us/articles/4403241044249-How-to-take-a-screenshot-of-desktop-entire-screen-or-an-application-window")})),$(".upgrade-btn").on("click",(function(){var e=$(this).attr("data-reason");Bg.googleEvent("upgrade from recording menu ("+e+")","upgrade"),Bg.goToUpgrade(e)})),$("#toggle-camera").on("click",(function(){sendMessage({action:"init-camera"}),window.close()}))}addShortcut(),!localStorage.capture_desktop||localStorage.capture_desktop,$("#show-advanced").on("click",(function(){$("#advanced-option-container").is(":visible")?$(this).removeClass("hide").find("span").text("Show Advanced Options"):$(this).addClass("hide").find("span").text("Hide Advanced Options"),$("#advanced-option-container").toggle()})),chrome.tabs.query({active:!0,currentWindow:!0},(function(e){var o=e[0],t=(url=o.url).match(/(https?|file):\/\/*\/*/gi);/Edg/.test(window.navigator.userAgent)?(null==t||url.match(/https:\/\/microsoftedge.microsoft.com\/addons/i))&&(isAllowContentJs=!1):(null==t||url.match(/https:\/\/chrome.google.com\/extensions/i)||url.match(/https:\/\/chrome.google.com\/webstore/i))&&(isAllowContentJs=!1),"complete"!=o.status&&($("#selected").attr({title:"Page still loading! Please wait."}).addClass("disabled"),enableSelected=!1),/http|https|file|ftp/.test(url.slice(0,5))||(isAllowContentJs=!1),isFileUrl=!!/file:/.test(url.slice(0,5))})),$("#open-setting").on("click",(function(){var e="chrome://extensions/?id="+chrome.runtime.id;chrome.tabs.create({url:e})})),chrome.extension.isAllowedFileSchemeAccess((function(e){fileAllowedAccess=e})),"recording"===Bg.recordingStatus&&(switchView("recording-view"),Bg.isRecordingPaused&&($("#recording-view").find(".recording-action").addClass("paused"),Bg.socketClient&&Bg.socketClient.paused&&$("#recording-error").show()),recordingTimer=setInterval(updateTime,100)),"preparing"===Bg.recordingStatus&&(Bg.isInCountdown?switchView("video-countdown-view"):switchView("video-prepare-view"),prepareInterval=setInterval((function(){"recording"===Bg.recordingStatus?(switchView("recording-view"),clearInterval(prepareInterval),prepareInterval=null,recordingTimer=setInterval(updateTime,100)):Bg.isInCountdown&&$("#countdown-num").text(Bg._cd)}),100)),chrome.runtime.onMessage.addListener((function(e,o,t){switch(e.action){case"enable_selected":if(url.match(/https:\/\/*\/*/gi))return void $("#selected").attr({title:"For security reason, Capture Selected Area doesn't work in https pages!"});enableSelected=!0,$("#selected").attr({title:""}).css({color:"#000"});break;case"shownew":case"closeWin":window.close();break;case"entireCaptureProgress":$("#entire-progress-percentage").text(e.percentage),$("#entire-progress").css("width",e.percentage),e.scrollNum&&e.scrollNum>=9&&$("#stop-msg").show()}})),$(".capture-menu").find(".action-item").on("click",(function(){var e=this.id;if("visible"===e||"selected"===e||"entire"===e||"delay"===e)if(isFileUrl&&!fileAllowedAccess)openPopup("file-access");else if(isAllowContentJs||isFileUrl){if(getCurrentTab({},(function(e){sendMessageToTab(e.id,{action:"tabCanScroll"})})),"cloud"===localStorage["save-capture-location"]&&!isSignIn)return void openPopup("sign-in","capture");sendMessage({action:e,actionFrom:"pop"}),Bg.googleEvent("capture "+e,"capture"),"entire"===e?switchView("capturing-view"):window.close()}else openPopup("reject-access");else if("desktop"===e){if("cloud"===localStorage["save-capture-location"]&&!isSignIn)return void openPopup("sign-in","capture");Bg.beginDesktop(),Bg.googleEvent("capture desktop","capture"),window.close()}else if("annotate"===e){var o=chrome.runtime.getURL("")+"upload.html";chrome.tabs.create({url:o}),Bg.googleEvent("capture local","capture"),window.close()}})),$("#aws-info-upgrade").on("click",(function(){Bg.googleEvent("upgrade from main menu","upgrade"),Bg.openNewTab("https://www.awesomescreenshot.com/pricing?from=extMenu"),window.close()})),$("#aws-login").on("click",(function(){Bg.openNewTab("https://www.awesomescreenshot.com/signin?from=ext_pop_bottom"),window.close()})),$(".link-item").on("click",(function(){var e=$(this).attr("data-url");Bg.openNewTab(e),window.close()})),$("#user").on("click",(function(){Bg.openNewTab("https://www.awesomescreenshot.com/settings"),window.close()})),$(".feedback").on("click",(function(){Bg.openNewTab("/feedback.html"),window.close()})),$(".backToMenu").on("click",(function(){switchView("main-menu")})),localStorage.delay_sec&&$("#delay").find(".countdown").text(localStorage.delay_sec+"s"),""!==localStorage.desktop_delay_sec&parseInt(localStorage.desktop_delay_sec)>0&&$("#desktop").find(".countdown").text(localStorage.desktop_delay_sec+"s"),$(".custom-select").find(".select-option-item").on("mousedown",(function(e,o){var t=$(this),i=$(this).attr("data-value"),a=$(this).attr("data-text"),n=$(this).parents(".custom-select").attr("data-option");function r(e){t.parents(".custom-select").attr("data-value",i).find(".display-item").text(a),t.siblings().removeClass("selected").end().addClass("selected"),e||(localStorage[n]=i)}if("max_resolution"===n){var c="local"===localStorage["save-location"];"720"===i?r(c):"1080"!==i&&"4k"!==i||(isSignIn?c?premiumLevel>1?r():openPopup("signin-local-upgrade","Record_resolution"):premiumLevel>1||totalVideoCount<20?r():openPopup("signin-limit-upgrade","Record_resolution"):openPopup("no-signin-local-upgrade","Record_resolution"))}else"save-location"===n?(isSignIn?"local"===i?parseInt(premiumLevel)<2&&0!==newPremium||0===parseInt(premiumLevel)?showLimit():(parseInt(premiumLevel),hideTip()):parseInt(premiumLevel)<2?totalVideoCount<20?totalVideoCount>10?showTry():hideTip():showLimit():hideTip():"local"===i?showLimit():$(".record-tip.limit").hide(),"local"===i?$("#record-bubble").removeClass("hidde-bubble"):($("#record-bubble").addClass("hidde-bubble"),o||isSignIn||openPopup("sign-in","record")),r(),isGetUserInfo&&restoreSettings()):("save-capture-location"===n&&("local"===i?$("#capture-bubble").removeClass("hidde-bubble"):($("#capture-bubble").addClass("hidde-bubble"),o||isSignIn||openPopup("sign-in","capture"))),r())})),initRecordMenu();