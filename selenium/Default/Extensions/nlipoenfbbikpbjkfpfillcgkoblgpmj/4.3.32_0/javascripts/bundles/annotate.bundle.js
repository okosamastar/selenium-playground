(()=>{"use strict";var e,t={45632:(e,t,r)=>{var i=r(67294),a=r(73935),n=r(94184),o=r.n(n),s=["callout","list"],c=r(14133),l=r(16931),u=r(85893);function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=m(e);if(t){var a=m(this).constructor;r=Reflect.construct(i,arguments,a)}else r=i.apply(this,arguments);return g(this,r)}}function g(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?y(e):t}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}chrome.extension.getBackgroundPage();const v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(h,e);var t,r,a,n=f(h);function h(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),(t=n.call(this,e)).outerContainer=(0,i.createRef)(),t.container=(0,i.createRef)(),t.doodleCanvas=(0,i.createRef)(),t.layerCanvas=(0,i.createRef)(),t.textareaOut=(0,i.createRef)(),t.textarea=(0,i.createRef)(),t.listDialog=(0,i.createRef)(),t.fileInput=(0,i.createRef)(),t.state={isInCropMode:!1,currentTool:"",currentColor:"rgb(255, 0, 0)",currentPenWidth:4,currentFontSize:32,currentFontFamily:"Times New Roman",cropWidth:0,cropHeight:0,resizeWidth:0,resizeHeight:0,resizeProportional:!0,currentScale:1,canUndo:!1,canRedo:!1,canClear:!1,canDeleteSelected:!0,isShownUpgrade:!1,isReady:!1,upgradeType:"",isTextBackground:!1,isPremium:!1,currentShape:"",changeShape:!1},t.handleFileInputChange=t.handleFileInputChange.bind(y(t)),t.editor_style_callback=t.editor_style_callback.bind(y(t)),t.initEditor=t.initEditor.bind(y(t)),t.insertImage=t.insertImage.bind(y(t)),t.finishEdit=t.finishEdit.bind(y(t)),t.handleKeyDown=t.handleKeyDown.bind(y(t)),t.handleCloseUpgrade=t.handleCloseUpgrade.bind(y(t)),t.handleTextBgChange=t.handleTextBgChange.bind(y(t)),t.handleResetList=t.handleResetList.bind(y(t)),t.getQueryVariable=t.getQueryVariable.bind(y(t)),t}return t=h,(r=[{key:"componentDidMount",value:function(){this.initEditor(this.props.imageUrl),document.addEventListener("keydown",this.handleKeyDown),this.props.onRef(this)}},{key:"handleDrawStyle",value:function(e){var t=this;if("undo"===e.type)this.state.isReady&&this.editor.undo();else if("premiumPlan"===e.type)this.setState({isPremium:!e.value});else if("clear"===e.type)this.editor.clear();else if("deleteSelected"===e.type)this.state.isReady&&this.editor.deleteSelected();else if("save"===e.type)if("true"==this.getQueryVariable("incognito")){var r=this.editor.getImageDataURL(this.props.contentType);this.props.handleFinishEdit(e.type,r)}else this.editor.getImageDataBlob(this.props.contentType,(function(r){t.props.handleFinishEdit(e.type,r)}));else if("copy"===e.type)this.editor.getImageDataBlob(this.props.contentType,(function(r){t.props.handleFinishEdit(e.type,r)}));else if("style"===e.type){var i=e.shape,a=e.style;if(this.state.isReady)if(this.state.currentShape.length>0&&this.state.currentShape!==i&&(this.setState({changeShape:!0}),this.editor.unSelectAll()),"insertImage"===i){if(!this.state.isPremium)return void this.setState({upgradeType:"insertImage",isShownUpgrade:!0});a.name&&this.insertImage(a.name)}else if("image"===i){if(!this.state.isPremium)return void this.setState({upgradeType:"image",isShownUpgrade:!0});if(a.name){var n="./images/svg/"+a.name+".svg";this.insertImage(n)}}else{if(!this.state.isPremium&&("callout"==i||"list"==i))return void this.setState({upgradeType:i,isShownUpgrade:!0});if(this.editor.setPenType(i),"rect_blur"!==i){var o=e.changeType;2==o?a.color&&this.editor.setPenColor(a.color):(3==o||a.color&&this.editor.setPenColor(a.color),"text"!==i&&"callout"!==i?a.width&&this.editor.setPenWidth(a.width):a.width&&(this.editor.setFontSize(a.width),this.editor.setPenWidth(4)))}}else{if(!this.state.isPremium&&("callout"==i||"list"==i||"image"==i||"insertImage"==i))return void this.setState({upgradeType:i,isShownUpgrade:!0});"image"!==i&&"insertImage"!==i&&this.setState({currentTool:i}),a.color&&this.setState({currentColor:a.color}),"text"!==i&&"callout"!==i?a.width&&this.setState({currentPenWidth:a.width}):a.width&&this.setState({currentPenWidth:4,currentFontSize:a.width})}}}},{key:"componentDidUpdate",value:function(e){e.imageUrl!==this.props.imageUrl&&""===e.imageUrl&&this.initEditor(this.props.imageUrl)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown),this.editor=null}},{key:"handleKeyDown",value:function(e){var t=e.keyCode;if(-1!==this.props.className.indexOf("active"))if(90===t&&(e.ctrlKey||e.metaKey))e.shiftKey?this.editor.redo():this.editor.undo();else if((46===t||8===t)&&this.state.canDeleteSelected){if(e.target.classList.contains("editor-textarea"))return;this.editor.deleteSelected()}}},{key:"handleCloseUpgrade",value:function(){this.setState({isShownUpgrade:!1});var e=this.getQueryVariable("mark");window.parent.postMessage({type:"closeModel",mark:e,data:"closeModel"},"*")}},{key:"finishEdit",value:function(e,t){}},{key:"handleResetList",value:function(){this.editor.resetList()}},{key:"handleTextBgChange",value:function(){this.editor.setTextBackground(!this.state.isTextBackground),this.setState({isTextBackground:!this.state.isTextBackground})}},{key:"handleResizeProportionChange",value:function(e){this.setState({resizeProportional:e.target.checked})}},{key:"handleResizeInputChange",value:function(e,t){var r=this.editor.bg_info.width/this.editor.bg_info.height;"width"===e?!0===this.state.resizeProportional?this.setState({resizeWidth:parseInt(t.target.value),resizeHeight:parseInt(t.target.value)/r}):this.setState({resizeWidth:parseInt(t.target.value)}):!0===this.state.resizeProportional?this.setState({resizeWidth:parseInt(t.target.value)*r,resizeHeight:parseInt(t.target.value)}):this.setState({resizeHeight:parseInt(t.target.value)})}},{key:"getResizeInfo",value:function(){var e=this.editor.bg_info;this.setState({resizeHeight:parseInt(e.height),resizeWidth:parseInt(e.width)})}},{key:"handleFileInputChange",value:function(e){var t=e.target.files[0],r=URL.createObjectURL(t);this.insertImage(r)}},{key:"editor_style_callback",value:function(e,t){var r=this.getQueryVariable("mark");if("selected"==e){if(t){var i="";switch(t.shape){case 1:i="curve";break;case 3:i="rect";break;case 4:i="ellipse";break;case 7:i="callout";break;case 30:i="image";break;case 8:i="list";break;case 23:case 20:case 2:i="line_arrow";break;case 5:i="rect_blur";break;case 80:i="text"}this.setState({currentShape:i})}else this.setState({currentShape:""});if(this.state.changeShape)return void this.setState({changeShape:!1})}window.parent.postMessage({type:e,mark:r,data:t},"*")}},{key:"getQueryVariable",value:function(e){for(var t=window.location.search.substring(1).split("&"),r=0;r<t.length;r++){var i=t[r].split("=");if(i[0]==e)return i[1]}return!1}},{key:"initEditor",value:function(e){if(e){this.container.current.style.position="absolute",this.container.current.style.setProperty("top",this.getQueryVariable("ct")+"px","important"),this.container.current.style.left=this.getQueryVariable("cl")+"px";var t=this,r=new Image;this.editor=new l.Z({out_container:this.outerContainer.current,container:this.container.current,doodle_canvas:this.doodleCanvas.current,layer_canvas:this.layerCanvas.current,textarea:this.textarea.current,textarea_out:this.textareaOut.current,$list_dialog:this.listDialog.current,image:r},(function(e,r){t.editor_style_callback(e,r)})),r.src=e,r.onload=function(){t.editor.setBgImage(r,!1),t.editor.setPenColor(t.state.currentColor),t.state.currentTool.length>0&&t.editor.setPenType(t.state.currentTool),t.editor.setFontSize(t.state.currentFontSize),t.editor.setPenWidth(t.state.currentPenWidth),t.editor.setFontName(t.state.currentFontFamily),t.editor.setBlurRadius(30),t.setState({isReady:!0})}}}},{key:"insertImage",value:function(e){var t=this,r=new Image;r.src=e;var i={image:r,width:0,height:0,choose_type:"full"};r.img_info=i,r.onload=function(){i.width=this.naturalWidth,i.height=this.naturalHeight,t.editor.insertSvgImage(i)}}},{key:"handleToolBarBtnClick",value:function(e,t){var r=this.editor;if("shape"===e){if(-1!==s.indexOf(t)&&!this.props.permissions.allowAdvancedToolForImageEditor)return void this.setState({upgradeType:t,isShownUpgrade:!0});"highlight"==t?(r.unSelectAll(),r.setPenOpacity(.3),r.setPenWidth(16),r.setPenType("highlight")):(r.setPenOpacity(1),r.setPenWidth(this.state.currentPenWidth),r.setPenType(t)),this.setState({currentTool:t})}else if("action"===e)switch(t.actionType){case"crop":this.setState({isInCropMode:!0}),r.cutImage();break;case"changeColor":this.setState({currentColor:t.value}),r.setPenColor(t.value),localStorage["pen-color"]=t.value;break;case"changePenWidth":this.setState({currentPenWidth:t.value}),r.setPenWidth(parseInt(t.value)),localStorage["pen-width"]=t.value;break;case"changeFontSize":this.setState({currentFontSize:t.value}),r.setFontSize(parseInt(t.value)),localStorage["font-size"]=t.value;break;case"changeFontFamily":this.setState({currentFontFamily:t.value}),r.setFontName(t.value),localStorage["font-family"]=t.value;break;case"zoom-in":if(2!==this.state.currentScale){var i=this.state.currentScale+.25;r.setScale(i),this.setState({currentScale:i,isShowScaleTip:!0})}break;case"zoom-out":.25!==this.state.currentScale&&(i=this.state.currentScale-.25,r.setScale(i),this.setState({currentScale:i,isShowScaleTip:!0}));break;case"resetScale":r.setScale(1),this.setState({currentScale:1,isShowScaleTip:!1});break;case"crop-demension-width":this.setState({cropWidth:parseInt(t.value)},(function(){r.setCropSize(this.state.cropWidth,this.state.cropHeight)}));break;case"crop-demension-height":this.setState({cropHeight:parseInt(t.value)},(function(){r.setCropSize(this.state.cropWidth,this.state.cropHeight)}));break;case"leaveCrop":this.setState({isInCropMode:!1,cropWidth:0,cropHeight:0}),r.finishCutImage(!1);break;case"doCrop":r.finishCutImage(!0),this.setState({isInCropMode:!1,cropWidth:0,cropHeight:0});break;case"insert-image":if(!this.props.permissions.allowAdvancedToolForImageEditor)return void this.setState({upgradeType:"insertImage",isShownUpgrade:!0});this.fileInput.current.click();break;case"doInsertImage":if(!this.props.permissions.allowAdvancedToolForImageEditor)return void this.setState({upgradeType:"image",isShownUpgrade:!0});var a="./images/svg/"+t.value+".svg";this.insertImage(a);break;case"doResize":r.setImageSize(this.state.resizeWidth,this.state.resizeHeight);break;default:r[t.actionType]()}}},{key:"render",value:function(){var e=this.state,t=e.isShownUpgrade,r=(e.isReady,o()("editor",this.props.className));return(0,u.jsxs)("div",{className:r,tabIndex:"0",children:[(0,u.jsx)("input",{type:"file",className:"file-input",ref:this.fileInput,accept:".jpg,.jpeg,.png",onChange:this.handleFileInputChange}),(0,u.jsx)("div",{className:"editor-outer-container",tabIndex:"0",id:"editor-outer-container",ref:this.outerContainer,children:(0,u.jsxs)("div",{className:"editor-container",ref:this.container,children:[(0,u.jsx)("canvas",{className:"doodle-canvas",id:"canvas",ref:this.doodleCanvas}),(0,u.jsx)("canvas",{className:"layer-canvas",id:"canvas2",ref:this.layerCanvas}),(0,u.jsx)("div",{className:"editor-outer-textarea",ref:this.textareaOut,children:(0,u.jsx)("textarea",{className:"editor-textarea",ref:this.textarea})}),(0,u.jsxs)("div",{className:"editor-list-dialog",ref:this.listDialog,children:["Number:",(0,u.jsx)("input",{type:"number"})]})]})}),(0,u.jsx)(c.Z,{visible:t,onCancel:this.handleCloseUpgrade,type:this.state.upgradeType})]})}}])&&d(t.prototype,r),a&&d(t,a),h}(i.PureComponent);r(31795);function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=P(e);if(t){var a=P(this).constructor;r=Reflect.construct(i,arguments,a)}else r=i.apply(this,arguments);return I(this,r)}}function I(e,t){return!t||"object"!==b(t)&&"function"!=typeof t?x(e):t}function x(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var C=chrome.extension.getBackgroundPage(),T=function(e){return"jpg"===e?"image/jpeg":"image/png"},R=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(n,e);var t,r,i,a=k(n);function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=a.call(this,e)).onRef=function(e){t.child=e},t.state={annotateImageUrl:"",saveImageUrl:"",imageBlob:null,contentType:"image/png",permissions:{},step:"edit"},t.handleImageBlob=t.handleImageBlob.bind(x(t)),t.initEditor=t.initEditor.bind(x(t)),t.getQueryVariable=t.getQueryVariable.bind(x(t)),t.handleDrawStyleAction=t.handleDrawStyleAction,t}return t=n,(r=[{key:"handleDrawStyleAction",value:function(e){this.child.handleDrawStyle(e)}},{key:"initEditor",value:function(e){if(e){var t={annotateImageUrl:e};this.setState(t)}}},{key:"componentDidMount",value:function(){var e=this;window.addEventListener("message",(function(t){"init"==t.data.type?e.initEditor(t.data.dataUrl):e.handleDrawStyleAction(t.data.data)}));var t=this.getQueryVariable("mark");window.parent.postMessage({type:"initIframe",mark:t},"*")}},{key:"componentWillUnmount",value:function(){document.removeEventListener("visibilitychange",(function(){})),window.removeEventListener("message")}},{key:"handleImageBlob",value:function(e,t){var r=this.getQueryVariable("mark");if("copy"===e)window.parent.postMessage({type:"copy",mark:r,data:t},"*");else if("save"===e){var i=this.getQueryVariable("incognito"),a=this.getQueryVariable("actionType");"true"==i?chrome.runtime.sendMessage({action:"saveImage",data:t,actionType:a,format:T(this.getQueryVariable("format"))},(function(){chrome.runtime.lastError})):C?C.saveAnnotatedImage(t,!0,a,T(this.getQueryVariable("format"))):chrome.runtime.sendMessage({action:"saveImage",data:window.URL.createObjectURL(t),actionType:a,format:T(this.getQueryVariable("format"))},(function(){chrome.runtime.lastError}))}}},{key:"getQueryVariable",value:function(e){for(var t=window.location.search.substring(1).split("&"),r=0;r<t.length;r++){var i=t[r].split("=");if(i[0]==e)return i[1]}return!1}},{key:"render",value:function(){var e=o()("sub-page",{active:"edit"===this.state.step});return this.state.saveImageUrl||this.state.annotateImageUrl?(0,u.jsx)(v,{imageUrl:this.state.annotateImageUrl,handleFinishEdit:this.handleImageBlob,permissions:this.state.permissions,className:e,type:"ext",contentType:T(this.getQueryVariable("format")),onRef:this.onRef}):(0,u.jsx)("div",{className:"loading-page",children:(0,u.jsx)("div",{className:"center"})})}}])&&S(t.prototype,r),i&&S(t,i),n}(i.Component);a.render((0,u.jsx)(R,{}),document.getElementById("edit-page"))}},r={};function i(e){var a=r[e];if(void 0!==a)return a.exports;var n=r[e]={id:e,loaded:!1,exports:{}};return t[e].call(n.exports,n,n.exports,i),n.loaded=!0,n.exports}i.m=t,e=[],i.O=(t,r,a,n)=>{if(!r){var o=1/0;for(u=0;u<e.length;u++){for(var[r,a,n]=e[u],s=!0,c=0;c<r.length;c++)(!1&n||o>=n)&&Object.keys(i.O).every((e=>i.O[e](r[c])))?r.splice(c--,1):(s=!1,n<o&&(o=n));if(s){e.splice(u--,1);var l=a();void 0!==l&&(t=l)}}return t}n=n||0;for(var u=e.length;u>0&&e[u-1][2]>n;u--)e[u]=e[u-1];e[u]=[r,a,n]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e;i.g.importScripts&&(e=i.g.location+"");var t=i.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");r.length&&(e=r[r.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e+"../../"})(),(()=>{var e={512:0};i.O.j=t=>0===e[t];var t=(t,r)=>{var a,n,[o,s,c]=r,l=0;for(a in s)i.o(s,a)&&(i.m[a]=s[a]);if(c)var u=c(i);for(t&&t(r);l<o.length;l++)n=o[l],i.o(e,n)&&e[n]&&e[n][0](),e[o[l]]=0;return i.O(u)},r=self.webpackChunkawesomescreenshot_front=self.webpackChunkawesomescreenshot_front||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),i.O(void 0,[186,377,618,347,139,0],(()=>i(33505)));var a=i.O(void 0,[186,377,618,347,139,0],(()=>i(45632)));a=i.O(a)})();